<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Mini-Maisa – Login</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --primary: #0072ce;
      --primary-dark: #0059a3;
      --bg: #f3f5f8;
      --card-bg: #ffffff;
      --border-subtle: #e1e4ea;
      --text-main: #222;
      --text-muted: #666;
    }
    * {
      box-sizing: border-box;
    }
    body {
      margin: 0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #cfe3ff 0, #f3f5f8 45%, #e3e7f0 100%);
      color: var(--text-main);
    }
    .card {
      width: 100%;
      max-width: 360px;
      background: var(--card-bg);
      border-radius: 16px;
      padding: 20px 20px 18px;
      box-shadow: 0 10px 30px rgba(0,0,0,0.08);
    }
    h1 {
      margin: 0 0 6px;
      font-size: 22px;
      text-align: center;
    }
    .subtitle {
      margin: 0 0 18px;
      font-size: 13px;
      text-align: center;
      color: var(--text-muted);
    }
    .form-field {
      margin-bottom: 12px;
      font-size: 14px;
    }
    .form-field label {
      display: block;
      margin-bottom: 4px;
    }
    .form-field input {
      width: 100%;
      padding: 7px 9px;
      border-radius: 10px;
      border: 1px solid var(--border-subtle);
      font-size: 14px;
    }
    .primary-btn {
      width: 100%;
      border: none;
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 15px;
      background: var(--primary);
      color: white;
      cursor: pointer;
      margin-top: 6px;
    }
    .primary-btn:active {
      background: var(--primary-dark);
    }
    .error {
      margin-top: 8px;
      font-size: 13px;
      color: #b3261e;
      min-height: 18px;
    }
    .hint {
      margin-top: 10px;
      font-size: 12px;
      color: var(--text-muted);
      text-align: center;
    }
    .hint code {
      font-size: 12px;
      background: #f3f5f8;
      padding: 2px 4px;
      border-radius: 4px;
    }
    .lang-toggle {
      display: flex;
      justify-content: center;
      gap: 8px;
      margin-bottom: 10px;
    }
    .lang-btn {
      border: none;
      background: #e3e7ef;
      color: #222;
      border-radius: 999px;
      padding: 3px 10px;
      font-size: 11px;
      cursor: pointer;
    }
    .lang-btn.active {
      background: var(--primary);
      color: white;
    }
  </style>
</head>
<body>

<div class="card">
  <div class="lang-toggle">
    <button class="lang-btn active" data-lang="en">EN</button>
    <button class="lang-btn" data-lang="fi">FI</button>
  </div>

  <h1 data-i18n="title">Mini-Maisa</h1>
  <p class="subtitle" data-i18n="subtitle">Sign in to your account</p>

  <div class="form-field">
    <label for="username" data-i18n="username_label">Username</label>
    <input id="username" autocomplete="username" />
  </div>

  <div class="form-field">
    <label for="password" data-i18n="password_label">Password</label>
    <input id="password" type="password" autocomplete="current-password" />
  </div>

  <button id="login-btn" class="primary-btn" data-i18n="login_button">Log in</button>

  <div id="error" class="error"></div>

  <div class="hint">
    <span data-i18n="hint_doctor_label">Doctor:</span>
    <code>doctor / doctor123</code><br />
    <span data-i18n="hint_patient_label">Patient:</span>
    <code>patient1 / patient123</code>
  </div>
</div>

<script>
const i18nLogin = {
  en: {
    title: "Mini-Maisa",
    subtitle: "Sign in to your account",
    username_label: "Username",
    password_label: "Password",
    login_button: "Log in",
    hint_doctor_label: "Doctor:",
    hint_patient_label: "Patient:",
    error_fill: "Fill username and password.",
    error_wrong: "Wrong username or password.",
    error_conn: "Connection error."
  },
  fi: {
    title: "Mini-Maisa",
    subtitle: "Kirjaudu sisään",
    username_label: "Käyttäjätunnus",
    password_label: "Salasana",
    login_button: "Kirjaudu",
    hint_doctor_label: "Lääkäri:",
    hint_patient_label: "Potilas:",
    error_fill: "Täytä käyttäjätunnus ja salasana.",
    error_wrong: "Väärä käyttäjätunnus tai salasana.",
    error_conn: "Yhteysvirhe."
  }
};

let currentLoginLang = "en";

function applyLoginLang(lang) {
  currentLoginLang = lang;
  document.querySelectorAll("[data-i18n]").forEach(el => {
    const key = el.dataset.i18n;
    if (i18nLogin[lang][key]) {
      el.textContent = i18nLogin[lang][key];
    }
  });
  document.querySelectorAll(".lang-btn").forEach(btn => {
    btn.classList.toggle("active", btn.dataset.lang === lang);
  });
}

function switchLoginLang(lang) {
  localStorage.setItem("uiLang", lang);
  applyLoginLang(lang);
}

document.querySelectorAll(".lang-btn").forEach(btn => {
  btn.onclick = () => switchLoginLang(btn.dataset.lang);
});

const savedLang = localStorage.getItem("uiLang") || "en";
applyLoginLang(savedLang);

async function login() {
  const u = document.getElementById("username").value.trim();
  const p = document.getElementById("password").value.trim();
  const errBox = document.getElementById("error");
  const lang = currentLoginLang;
  errBox.textContent = "";

  if (!u || !p) {
    errBox.textContent = i18nLogin[lang].error_fill;
    return;
  }

  try {
    const res = await fetch("/api/login", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ username: u, password: p })
    });

    if (!res.ok) {
      errBox.textContent = i18nLogin[lang].error_wrong;
      return;
    }

    const data = await res.json();
    localStorage.setItem("authToken", data.token);
    localStorage.setItem("authRole", data.user.role);
    localStorage.setItem("authUser", data.user.username);

    if (data.user.role === "doctor") {
      window.location.href = "/doctor.html";
    } else {
      window.location.href = "/index.html";
    }
  } catch (e) {
    errBox.textContent = i18nLogin[lang].error_conn;
  }
}

document.getElementById("login-btn").onclick = login;

document.addEventListener("keydown", e => {
  if (e.key === "Enter") login();
});
</script>

</body>
</html>


